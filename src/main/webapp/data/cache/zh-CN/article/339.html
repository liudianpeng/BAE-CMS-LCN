<!doctype html> <html lang="zh-CN"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="keywords" content="数据"> <meta name="author" content="marker"> <title>DBC数据源(DataSource)的简单实现 - 蘑菇内容管理系统(MRCMS)官方网站 Power By marker</title> <link href="http://192.168.1.5:8080/themes/flatweb/lib/bootstrap3/css/bootstrap.min.css" rel="stylesheet" type="text/css"> <link href="http://192.168.1.5:8080/themes/flatweb/lib/bootstrap3/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css"> <link href="http://192.168.1.5:8080/themes/flatweb/lib/highlight/styles/default.css" rel="stylesheet" type="text/css"/> <link href="http://192.168.1.5:8080/themes/flatweb/css/main.css" rel="stylesheet" type="text/css"> </head> <body> <!-- Docs master nav --> <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner"> <div class="container"> <div class="navbar-header"> <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse"> <span class="sr-only">Toggle Nav</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a href="/" class="navbar-brand">MRCMS</a> </div> <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation"> <ul class="nav navbar-nav"> <li> <a href="http://192.168.1.5:8080/index.html">网站主页 </a> </li> <li> <a href="http://192.168.1.5:8080/about.html">关于项目 </a> </li> <li> <a data-toggle="dropdown" class="dropdown-toggle" href="http://192.168.1.5:8080/document.html">帮助文档 <span class="caret"></span> <ul class="dropdown-menu" role="menu"> <li><a href="http://192.168.1.5:8080/document/template.html">模板文档</a></li> <li><a href="http://192.168.1.5:8080/document/module.html">模块文档</a></li> <li><a href="http://192.168.1.5:8080/document/groovy.html">Groovy文档</a></li> </ul> </a> </li> <li> <a href="http://192.168.1.5:8080/logger.html">更新日志 </a> </li> <li> <a href="http://192.168.1.5:8080/guestbook.html">在线留言 </a> </li> </ul> </nav> <!--{bootstrap nav} --> </div> </header> <div class="container" style="margin:30px auto;"> <div class="row"> <div class="col-md-8"> <div class="content"> <h2 style="margin-top:60px;">DBC数据源(DataSource)的简单实现</h2> <div>发布时间：2016-3-10 11:30:24</div> <p> <p><strong style="padding: 0px; margin: 0px;"><span style="color:#ff0000;font-size:16px;padding: 0px; margin: 0px;">JDBC数据源(DataSource)的简单实现</span></strong></p><p>&nbsp;</p><p>数据源技术是Java操作数据库的一个很关键技术，流行的持久化框架都离不开数据源的应用。</p><p>&nbsp;</p><p>数据源提供了一种简单获取数据库连接的方式，并能在内部通过一个池的机制来复用数据库连接，这样就大大减少创建数据库连接的次数，提高了系统性能。</p><p>&nbsp;</p><p>对于数据源的应用，一般都选择实用开源的数据源或数据库连接池来使用，比如，常见的有DBCP、C3P0、Proxool等等。但用起来有些笨重和麻烦。下面自己手动实现个精简的数据源，代码如下：</p><p>&nbsp;</p><p><span style="color:#0000ff;padding: 0px; margin: 0px;">package</span>&nbsp;com.lavasoft.simpledatesource;&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;org.apache.commons.logging.Log;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;org.apache.commons.logging.LogFactory;&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;javax.sql.DataSource;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.util.Collections;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.util.LinkedList;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.sql.Connection;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.sql.SQLException;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.sql.DriverManager;&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">import</span>&nbsp;java.io.PrintWriter;&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/><span style="color:#008000;padding: 0px; margin: 0px;">/**&nbsp;<br style="padding: 0px; margin: 0px;"/>* 一个简单的DataSource实现&nbsp;<br style="padding: 0px; margin: 0px;"/>*&nbsp;<br style="padding: 0px; margin: 0px;"/>* @author leizhimin 2010-1-14 0:03:17&nbsp;<br style="padding: 0px; margin: 0px;"/>*/</span>&nbsp;<br style="padding: 0px; margin: 0px;"/><span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">class</span>&nbsp;SimpleDateSource&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">implements</span>&nbsp;DataSource {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;Log log = LogFactory.getLog(SimpleDateSource.<span style="color:#0000ff;padding: 0px; margin: 0px;">class</span>);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">final</span>&nbsp;String dirverClassName =&nbsp;<span style="color:#800000;padding: 0px; margin: 0px;">&quot;com.mysql.jdbc.Driver&quot;</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">final</span>&nbsp;String url =&nbsp;<span style="color:#800000;padding: 0px; margin: 0px;">&quot;jdbc:mysql:<span style="color:#008000;padding: 0px; margin: 0px;">//127.0.0.1:3306/testdb&quot;;&nbsp;</span><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">final</span>&nbsp;String user =&nbsp;<span style="color:#800000;padding: 0px; margin: 0px;">&quot;root&quot;</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">final</span>&nbsp;String pswd =&nbsp;<span style="color:#800000;padding: 0px; margin: 0px;">&quot;leizhimin&quot;</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000;padding: 0px; margin: 0px;">//连接池&nbsp;</span><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;LinkedList&lt;Connection&gt; pool = (LinkedList&lt;Connection&gt;) Collections.synchronizedList(<span style="color:#0000ff;padding: 0px; margin: 0px;">new</span>&nbsp;LinkedList&lt;Connection&gt;());&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;SimpleDateSource instance =&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">new</span>&nbsp;SimpleDateSource();&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;{&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">try</span>&nbsp;{&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class.forName(dirverClassName);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">catch</span>&nbsp;(ClassNotFoundException e) {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.error(<span style="color:#800000;padding: 0px; margin: 0px;">&quot;找不到驱动类！&quot;</span>, e);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;SimpleDateSource() {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000;padding: 0px; margin: 0px;">/**&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 获取数据源单例&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * @return 数据源单例&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span>&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;SimpleDateSource instance() {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">if</span>&nbsp;(instance ==&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">null</span>) instance =&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">new</span>&nbsp;SimpleDateSource();&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;instance;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000;padding: 0px; margin: 0px;">/**&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 获取一个数据库连接&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * @return 一个数据库连接&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * @throws SQLException&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span>&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;Connection getConnection()&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">synchronized</span>&nbsp;(pool) {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">if</span>&nbsp;(pool.size() &gt; 0)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;pool.removeFirst();&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">else</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;makeConnection();&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000;padding: 0px; margin: 0px;">/**&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 连接归池&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * @param conn&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</span>&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">static</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">void</span>&nbsp;freeConnection(Connection conn) {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool.addLast(conn);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">private</span>&nbsp;Connection makeConnection()&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;DriverManager.getConnection(url, user, pswd);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;Connection getConnection(String username, String password)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;DriverManager.getConnection(url, username, password);&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;PrintWriter getLogWriter()&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">null</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">void</span>&nbsp;setLogWriter(PrintWriter out)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">void</span>&nbsp;setLoginTimeout(<span style="color:#0000ff;padding: 0px; margin: 0px;">int</span>&nbsp;seconds)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">int</span>&nbsp;getLoginTimeout()&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;0;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;&lt;T&gt; T unwrap(Class&lt;T&gt; iface)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">null</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/><br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">public</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">boolean</span>&nbsp;isWrapperFor(Class&lt;?&gt; iface)&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">throws</span>&nbsp;SQLException {&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">return</span>&nbsp;<span style="color:#0000ff;padding: 0px; margin: 0px;">false</span>;&nbsp;<br style="padding: 0px; margin: 0px;"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br style="padding: 0px; margin: 0px;"/>}</span></p><p>&nbsp;</p><p>这个数据源的实现虽然很简陋，总代码量不到百行，却基本上实现了数据源的所有功能，达到了提高Connection复用的目的。</p><p>&nbsp;</p><p>如果你想做的更复杂些，做个配置文件，</p><p>配置数据库连接信息</p><p>写个后台线程监控连接池的Connection超时、被强制关闭、池的尺寸、当前大小等等。</p><p>再完善下数据源的log相关方法的实现。</p><p>功能就很强大了。</p><p>&nbsp;</p><p>欢迎参与完善！</p><p><br/></p> </p> </div> </div> </div> </div> <div class="footer"> <div class="container" style="margin:20px auto;"> <div class="row"> <div class="col-md-2"> </div> <div class="col-md-2"> <dl class="footer_list"> <dt>关于我们</dt> <dd><a href="http://www.yl-blog.com">雨林博客</a></dd> <dd><a href="http://t.qq.com/wuweiit">@wuweiit</a></dd> </dl> </div> <div class="col-md-2"> <dl class="footer_list"> <dt>产品购买</dt> <dd>开发文档</dd> <dd>Web项目开发</dd> </dl> </div> <div class="col-md-2"> <dl class="footer_list"> <dt>服务范围</dt> <dd>Web界面设计</dd> <dd>网站建设</dd> <dd>系统维护</dd> </dl> </div> <div class="col-md-2"> <dl class="footer_list"> <dt>交流学习</dt> <dd>QQ群: 331925386</dd> <dd><a href="http://bbs.yl-blog.com/">bbs.yl-blog.com</a></dd> </dl> </div> <div class="col-md-2"> <img src="http://192.168.1.5:8080/themes/flatweb/images/mp.jpg" style="width:120px; height:120px;" /> </div> </div> </div> <div class="copyright"> &copy; CopyRight 2012-2014 蘑菇内容管理系统 版权所有 &nbsp; [gzip] &nbsp; 在线 1 人 &nbsp;0.294 sec. 蜀ICP备14017469号 </div> </div> <!-- js loading --> <script src="http://192.168.1.5:8080/themes/flatweb/lib/jquery/jquery.min.js" type="text/javascript"></script> <script src="http://192.168.1.5:8080/themes/flatweb/lib/bootstrap3/js/bootstrap.min.js" type="text/javascript"></script> <script src="http://192.168.1.5:8080/themes/flatweb/lib/highlight/highlight.pack.js" type="text/javascript"></script> <script type="text/javascript"> // 高亮渲染初始化 hljs.initHighlightingOnLoad(); </script> </body> </html> <script type="text/javascript" src="http://192.168.1.5:8080/public/fetch/main.js"></script>